<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>D-Bus: Hash table implementation details</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">D-Bus
   &#160;<span id="projectnumber">1.6.8</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Hash table implementation details</div>  </div>
<div class="ingroups"><a class="el" href="group__DBusInternals.html">D-Bus secret internal implementation details</a></div></div><!--header-->
<div class="contents">

<p><a class="el" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> implementation details.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDBusHashEntry.html">DBusHashEntry</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal representation of a hash entry.  <a href="structDBusHashEntry.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDBusHashTable.html">DBusHashTable</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Internals of <a class="el" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>.  <a href="structDBusHashTable.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDBusRealHashIter.html">DBusRealHashIter</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Internals of <a class="el" href="structDBusHashIter.html" title="Hash iterator object.">DBusHashIter</a>.  <a href="structDBusRealHashIter.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga8c6d6296d450e37074dbd8c15638b499"></a><!-- doxytag: member="DBusHashTableInternals::REBUILD_MULTIPLIER" ref="ga8c6d6296d450e37074dbd8c15638b499" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DBusHashTableInternals.html#ga8c6d6296d450e37074dbd8c15638b499">REBUILD_MULTIPLIER</a>&#160;&#160;&#160;3</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">When there are this many entries per bucket, on average, rebuild the hash table to make it larger. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DBusHashTableInternals.html#ga9dc8fd5a9e25bd2b229366a683ff78f9">RANDOM_INDEX</a>(table, i)&#160;&#160;&#160;(((((intptr_t) (i))*1103515245) &gt;&gt; (table)-&gt;down_shift) &amp; (table)-&gt;mask)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Takes a preliminary integer hash value and produces an index into a hash tables bucket list.  <a href="#ga9dc8fd5a9e25bd2b229366a683ff78f9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DBusHashTableInternals.html#ga4518324f3c3caacf5694065f4f6071d8">DBUS_SMALL_HASH_TABLE</a>&#160;&#160;&#160;4</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initial number of buckets in hash table (hash table statically allocates its buckets for this size and below).  <a href="#ga4518324f3c3caacf5694065f4f6071d8"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad7d2d7c568541eeeb86104138d64a9f3"></a><!-- doxytag: member="DBusHashTableInternals::DBusHashEntry" ref="gad7d2d7c568541eeeb86104138d64a9f3" args="" -->
typedef struct <a class="el" href="structDBusHashEntry.html">DBusHashEntry</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DBusHashTableInternals.html#gad7d2d7c568541eeeb86104138d64a9f3">DBusHashEntry</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Typedef for <a class="el" href="structDBusHashEntry.html" title="Internal representation of a hash entry.">DBusHashEntry</a>. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga20a95a9ff37ad777575336e9e4fd8a10"></a><!-- doxytag: member="DBusHashTableInternals::DBusFindEntryFunction" ref="ga20a95a9ff37ad777575336e9e4fd8a10" args=")(DBusHashTable *table, void *key, dbus_bool_t create_if_not_found, DBusHashEntry ***bucket, DBusPreallocatedHash *preallocated)" -->
typedef <a class="el" href="structDBusHashEntry.html">DBusHashEntry</a> *(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DBusHashTableInternals.html#ga20a95a9ff37ad777575336e9e4fd8a10">DBusFindEntryFunction</a> )(<a class="el" href="structDBusHashTable.html">DBusHashTable</a> *table, void *key, <a class="el" href="group__DBusTypes.html#ga39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a> create_if_not_found, <a class="el" href="structDBusHashEntry.html">DBusHashEntry</a> ***bucket, <a class="el" href="group__DBusHashTable.html#ga175dc6ab841ed32bb6acf6e4c0df36a8">DBusPreallocatedHash</a> *preallocated)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Function used to find and optionally create a hash entry. <br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gab7d4017620f34489bca6ab3117c13bfd"></a><!-- doxytag: member="DBusHashTableInternals::_DBUS_STATIC_ASSERT" ref="gab7d4017620f34489bca6ab3117c13bfd" args="(sizeof(DBusRealHashIter)==sizeof(DBusHashIter))" -->
&#160;</td><td class="memItemRight" valign="bottom"><b>_DBUS_STATIC_ASSERT</b> (sizeof(<a class="el" href="structDBusRealHashIter.html">DBusRealHashIter</a>)==sizeof(<a class="el" href="structDBusHashIter.html">DBusHashIter</a>))</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p><a class="el" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a> implementation details. </p>
<p>The guts of <a class="el" href="structDBusHashTable.html" title="Internals of DBusHashTable.">DBusHashTable</a>. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga4518324f3c3caacf5694065f4f6071d8"></a><!-- doxytag: member="dbus&#45;hash.c::DBUS_SMALL_HASH_TABLE" ref="ga4518324f3c3caacf5694065f4f6071d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="group__DBusHashTableInternals.html#ga4518324f3c3caacf5694065f4f6071d8">DBUS_SMALL_HASH_TABLE</a>&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initial number of buckets in hash table (hash table statically allocates its buckets for this size and below). </p>
<p>The initial mask has to be synced to this. </p>

<p>Definition at line <a class="el" href="dbus-hash_8c_source.html#l00130">130</a> of file <a class="el" href="dbus-hash_8c_source.html">dbus-hash.c</a>.</p>

<p>Referenced by <a class="el" href="dbus-hash_8c_source.html#l00285">_dbus_hash_table_new()</a>.</p>

</div>
</div>
<a class="anchor" id="ga9dc8fd5a9e25bd2b229366a683ff78f9"></a><!-- doxytag: member="dbus&#45;hash.c::RANDOM_INDEX" ref="ga9dc8fd5a9e25bd2b229366a683ff78f9" args="(table, i)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="group__DBusHashTableInternals.html#ga9dc8fd5a9e25bd2b229366a683ff78f9">RANDOM_INDEX</a></td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">table, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">i&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(((((intptr_t) (i))*1103515245) &gt;&gt; (table)-&gt;down_shift) &amp; (table)-&gt;mask)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Takes a preliminary integer hash value and produces an index into a hash tables bucket list. </p>
<p>The idea is to make it so that preliminary values that are arbitrarily similar will end up in different buckets. The hash function was taken from a random-number generator. (This is used to hash integers.)</p>
<p>The down_shift drops off the high bits of the hash index, and decreases as we increase the number of hash buckets (to keep more range in the hash index). The mask also strips high bits and strips fewer high bits as the number of hash buckets increases. I don't understand two things: why is the initial downshift 28 to keep 4 bits when the initial mask is 011 to keep 2 bits, and why do we have both a mask and a downshift? </p>

<p>Definition at line <a class="el" href="dbus-hash_8c_source.html#l00122">122</a> of file <a class="el" href="dbus-hash_8c_source.html">dbus-hash.c</a>.</p>

</div>
</div>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 21 2012 17:59:19 for D-Bus by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
